#textdomain wesnoth-The_Legend_Begins

[scenario]
    id="51_Too_Late"
    name= _ "Too Late"
    next_scenario="52_Clash_of_Armies"
    map_data="{~add-ons/The_Legend_Begins/maps/episode-3/51_Too_Late.map}"

    {~add-ons/The_Legend_Begins/macros/deaths.cfg}
    {~add-ons/The_Legend_Begins/macros/recurring-events.cfg}
    {~add-ons/The_Legend_Begins/macros/custom-advancement.cfg}

# I know I gave you insufficient human troops, but you get to recruit dwarves and faeries!

    {TLB_LIMIT_ARMY 1 (race=human) ("Infantryman,Bowman,Cavalryman,Cavalry Archer,Heavy Infantryman") 8 "human_troops"}
    {TLB_LIMIT_ARMY 1 (race=fairy) ("Faerie Sprite") 3 "faeries"}
    {TLB_LIMIT_ARMY 1 (race=dwarf) ("Dwarvish Fighter,Dwarvish Thunderer") 5 "dwarven_troops"}

    {TURNS 24 22 20}
    {TIME_OVER_DEFEAT}

    {DEFAULT_MUSIC_PLAYLIST}
    {DEFAULT_SCHEDULE_DUSK}

    victory_when_enemies_defeated=yes

    [story]
        [part]
           music="revelation.ogg"
           story= _ "Shortly after the battle, a funeral was held on the courtyard and Sadia was buried with full honors. Jahin and his friends were asked to give personal speeches about how well they knew Sadia and perhaps the most emotional speech was given by Fairuz. He was greatly depressed with her passing and said that he would to do all he could to bring peace to the land, which was Sadia's wish as she had told him one night as a means to start an idle conversation. Galec was unable to attend the funeral as he was tasked with routing the last of the enemy troops."
        [/part]

        [part]
           story= _ "When Galec and his army had returned, a brief council was held at the new home of the elves..."
        [/part]

        [part]
           background="portraits/elves/transparent/high-lord.png"
           scale_background=no
           story={CAPTION (_ "Lord Morfin")}+ _ "Today, we have won a great victory. We have finally found a new home. A home, in which we would be undisturbed and free to attend to our own matters. As for our distant kinsmen, they have decided to settle in the southern coast. I have tried to convince them to stay here with us, but they seem to have grown accustomed to the barren lands. Galec, have you positioned the bulk of our army at the Northern border of this forest?"
        [/part]

        [part]
           background="portraits/galec.png"
           scale_background=no
           story={CAPTION (_ "Galec")}+ _ "I have, my lord. Those vampires will think twice about attacking us here now. I suggest we start building. There's a lot of work to do, starting with that blood lake."
        [/part]

        [part]
           background="portraits/jahin.png"
           scale_background=no
           story={CAPTION (_ "Jahin")}+ _ "Lord elf, I greatly doubt this. The vampires still have those wood-folk with them. So, they may still decide to mount attacks here."
        [/part]

        [part]
           background="portraits/elves/transparent/high-lord.png"
           scale_background=no
           story={CAPTION (_ "Lord Morfin")}+ _ "No, Jahin. You underestimate us. The forest and elves have a sort of affinity with one another. We can sense the coming of foes as soon as they set foot in the forest and nullify their attempts at an attack. Besides, I'm very sure that the vampires would be currently focusing on their northern and western borders."
        [/part]

        [part]
           background="portraits/fairuz.png"
           scale_background=no
           story={CAPTION (_ "Fairuz")}+ _ "That's right. Lord Morfin, could you spare a few forces to reinforcement Jalin's men. They have been holding a fortress of the vampires alongside the dwarves for about a month now. They could use some assistance."
        [/part]

        [part]
           background="portraits/elves/transparent/high-lord.png"
           scale_background=no
           story={CAPTION (_ "Lord Morfin")}+ _ "I'm afraid not. We have already lost so many soldiers, that we only have about a few hundred left and they are all at the northern border. Perhaps you should seek aid from Kind Glamatus of the dwarves. He may be willing to spare some troops."
        [/part]

        [part]
           background="portraits/jahin.png"
           scale_background=no
           story={CAPTION (_ "Jahin")}+ _ "Thank you, for your advice, lord elf. We shall leave shortly as New Genesis was besieged by the Imperialists the last time I saw it before being sent to the demon realm."
        [/part]

        [part]
           background="portraits/galec.png"
           scale_background=no
           story={CAPTION (_ "Galec")}+ _ "The demon realm?! Jahin, how did you manage to get there?"
        [/part]
        
        [part]
           background="portraits/jahin.png"
           scale_background=no
           story={CAPTION (_ "Jahin")}+ _ "My men and I were teleported there. The leader of the Chaos Imperials showed up and he commanded that storm-witch to send us into the demon realm. Luckily for us, we found a demon enchantress who was happy to send us back to Irdya."
        [/part]

        [part]
           background="portraits/elves/transparent/high-lord.png"
           scale_background=no
           story={CAPTION (_ "Lord Morfin")}+ _ "Did she want anything in return?"
        [/part]

        [part]
           background="portraits/jahin.png"
           scale_background=no
           story={CAPTION (_ "Jahin")}+ _ "As a matter of fact, she did. She wants us to attack the Chaos capital and close the portal to the demon realm."
        [/part]

        [part]
           background="portraits/elves/transparent/high-lord.png"
           scale_background=no
           story={CAPTION (_ "Lord Morfin")}+ _ "How shall you achieve that? Their capital is on an island which is completely under their control."
        [/part]

        [part]
           background="portraits/jahin.png"
           scale_background=no
           story={CAPTION (_ "Jahin")}+ _ "There is always a way, lord elf. We just need to figure out what it is. We should get going now. Fairuz, tell the men to prepare for the journey home."
        [/part]

        [part]
           background="portraits/fairuz.png"
           scale_background=no
           story={CAPTION (_ "Fairuz")}+ _ "Okay. I will get right on it."
        [/part]

        [part]
           background="portraits/elves/transparent/druid.png"
           scale_background=no
           story={CAPTION (_ "Amorith")}+ _ "Jahin, let me send some of my faeries with you. They may be of aid to you."
        [/part]

        [part]
           background="portraits/jahin.png"
           scale_background=no
           story={CAPTION (_ "Jahin")}+ _ "Thank you, Amorith. I have a feeling that they shall be of invaluable aid."
        [/part]

        [part]
           background="portraits/elves/transparent/high-lord.png"
           scale_background=no
           story={CAPTION (_ "Lord Morfin")}+ _ "<i>(handing Jahin the Book of Ancients)</i> Jahin, wait. Take this. This book has already cost us a lot of trouble. May you find some spells that benefit your city in some way."
        [/part]

        [part]
           background="portraits/jahin.png"
           scale_background=no
           story={CAPTION (_ "Jahin")}+ _ "<i>(Giving the Book to Ashhab)</i> Thank you, lord elf. This might helpful someday."
        [/part]

        [part]
           story= _ "As dusk approached, the remainder of the human army accompanied by the faeries left the forest and entered into the small but beautiful kingdom of the dwarves. They met King Glamatus again and explained there situation. As Lord Morfin had said earlier, the dwarven king gave Jahin a small group of his soldiers as the majority of the dwarven soldiers were at the northern, southern and western gates. Strengthened, by new recruits, Jahin and his friends took only three days to return to the outskirts of New Genesis. When they arrived there, they were met with a horrendous sight..."
        [/part]
       
    [/story]


    [side]
        side=1
        team_name="good"
        user_team_name= _ "New Genesis"
        profile="portraits/jahin.png"
        unrenameable=yes
        canrecruit=yes
        controller=human
        id="Jahin"
        {FLAG_VARIANT loyalist}
        name= _ "Jahin"
        type="Captain"
        {GOLD 180 150 120}
        recruit="Infantryman,Bowman,Cavalryman,Cavalry Archer,Faerie Sprite,Dwarvish Fighter,Dwarvish Thunderer,Heavy Infantryman"
        [modifications]
             {TRAIT_FEARLESS}
        [/modifications]
        [unit]
             {IS_HERO}
             id="Ashhab"
             name= _ "Ashhab"
             profile="portraits/ashhab.png"
             type="Tempest Mage"
             placement=leader
             unrenameable=yes
             [modifications]
                  {TRAIT_LOYAL}
                  {TRAIT_RESILIENT}
             [/modifications]
        [/unit]
        [unit]
             {IS_HERO}
             id="Fairuz"
             name= _ "Fairuz"
             profile="portraits/fairuz.png"
             type="Swordsman"
             placement=leader
             unrenameable=yes
             [modifications]
                  {TRAIT_LOYAL}
                  {TRAIT_INTELLIGENT}
             [/modifications]
        [/unit]
        [unit]
             {IS_LOYAL}
             id="Kulnar"
             name= _ "Kulnar"
             type="Dwarvish Steelclad"
             placement=leader
             unrenameable=yes
             [modifications]
                  {TRAIT_LOYAL}
                  {TRAIT_QUICK}
             [/modifications]
        [/unit]
    [/side]

    {STARTING_VILLAGES 1 3}

    [side]
        side=2
        team_name="evil"
        user_team_name= _ "Chaos"

        #ifdef HARD
        type="Hell Overlord"
        #else
        type="Chaos Razerman"
        #endif

        id="Comdr. Dadoc"
        name= _ "Comdr. Dadoc"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT undead}

        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_pattern "fighter,archer,fighter,fighter,scout"}
            {AI_SIMPLE_ALWAYS_ASPECT aggression "1.0"}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value "3"}
            {AI_SIMPLE_ALWAYS_ASPECT caution "0.2"}
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_ignore_bad_movement "yes"}
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_ignore_bad_combat "yes"}
            {ATTACK_DEPTH 3 4 5}
        [/ai]

        [unit]
            type="Doom Guard"
            placement=leader
        [/unit]
        [unit]
            type="Chaos Magus"
            placement=leader
        [/unit]
        [unit]
            type="Demon Mage"
            placement=leader
        [/unit]

        {GOLD 200 220 250}
        {INCOME 0 1 2}

        #ifdef EASY
        recruit="Chaos Invader,Chaos Gunner,Chaos Invoker,Chaos Raider,Demon"
        #else
        recruit="Chaos Invader,Chaos Gunner,Chaos Invoker,Chaos Raider,Demon,Chaos Knight"
        #endif
    [/side]

    {STARTING_VILLAGES 2 10}

    #ifndef EASY
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Chaos Knight" 2}
    #endif

# Wanted.
# Make New Genesis look like a destroyed ruin

    {PLACE_IMAGE "scenery/gore-1.png" 8 12}
    {PLACE_IMAGE "scenery/gore-2.png" 12 15}
    {PLACE_IMAGE "scenery/gore-3.png" 15 19}
    {PLACE_IMAGE "scenery/gore-4.png" 15 25}
    {PLACE_IMAGE "scenery/gore-1.png" 6 26}
    {PLACE_IMAGE "scenery/gore-3.png" 16 21}

    {PLACE_IMAGE "scenery/blood-1.png" 19 9}
    {PLACE_IMAGE "scenery/blood-2.png" 15 9}
    {PLACE_IMAGE "scenery/blood-3.png" 8 10}
    {PLACE_IMAGE "scenery/blood-1.png" 16 21}
    {PLACE_IMAGE "scenery/blood-2.png" 5 25}
    {PLACE_IMAGE "scenery/blood-3.png" 11 24}

    {PLACE_IMAGE "units/human-loyalists/cavalryman-die-2.png~RC(magenta>red)" 8 11}
    {PLACE_IMAGE "units/human-loyalists/lieutenant-die-9.png~RC(magenta>red)" 12 13}
    {PLACE_IMAGE "units/human-loyalists/lieutenant-die-9.png~RC(magenta>red)" 19 25}
    {PLACE_IMAGE "units/human-loyalists/cavalryman-die-2.png~RC(magenta>red)" 25 29}
    {PLACE_IMAGE "units/human-loyalists/lieutenant-die-9.png~RC(magenta>red)" 6 28}
    {PLACE_IMAGE "units/human-loyalists/lieutenant-die-9.png~RC(magenta>red)" 13 27}
    {PLACE_IMAGE "units/human-loyalists/cavalryman-die-2.png~RC(magenta>red)" 10 19}


    [event]
        name="start"

        [message]
            speaker="Fairuz"
            message= _ "<i>(shocked)</i> Oh no!"
        [/message]
        [message]
            speaker="Ashhab"
            message= _ "We're too late! New Genesis has fallen!"
        [/message]

        [message]
            speaker="Comdr. Dadoc"
            message= _ "How are you still alive?! We killed anything living on sight!"
        [/message]
        [message]
            speaker="Jahin"
            message= _ "You killed a good friend of mine! Now, I shall slay you in cold-blood! Soldiers of New Genesis, show them no mercy!"
        [/message]
        [message]
            speaker="Kulnar"
            message= _ "Get ready to kiss my axe!"
        [/message]
        [message]
            speaker="Comdr. Dadoc"
            message= _ "I did love to see you try, weakling!"
        [/message]

        [message]
            speaker="Fairuz"
            message= _ "Jahin, are you insane?! We can't beat them whilst they are within the walls of New Genesis."
        [/message]
        [message] 
            speaker="Jahin"
            message= _ "Precisely. We shall lure them outside and then attack."
        [/message]

        [message]
            speaker="narrator"
            image="wesnoth-icon.png"
            message= _ "You may recruit <i>Dwarvish Fighters</i> and <i>Dwarvish Thunderers</i>. <i>Dwarvish Fighters</i> are able to advance to <i>Dwarvish Runesmiths</i>. <i>Faerie Sprites</i> are also recruitable, thought for this scenario only."
        [/message]

        [objectives]
            [objective]
                description= _ "Defeat the enemy commander."
                condition="win"
            [/objective]
            [objective]
                description= _ "Death of Jahin."
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of a hero unit."
                condition="lose"
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                carryover_percentage=80
                bonus=yes
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name="enemies defeated"

        # Affan's surprise

        [unit]
           side=1
           {IS_HERO}
           unrenameable=yes
           id="Affan"
           name= _ "Affan"
           profile="portraits/affan.png"
           [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
           [/modifications]
           x,y=18,19
           facing=se
           animate=yes
           type="Longbowman"
           experience=12
        [/unit]

        {GENERIC_UNIT 1 "Swordsman" 18 19}
        [+unit]
           experience=20
        [/unit]

        {GENERIC_UNIT 1 "Shock Trooper" 18 19}
        [+unit]
           experience=20
        [/unit]

        [message]
            speaker="Affan"
            message= _ "Get ready to die...Wait, he's already dead. Jahin, where were you guys?"
        [/message]
        [message]
            speaker="Jahin"
            message= _ "It's a long story. But, how did you survive their onslaught?"
        [/message]
        [message]
            speaker="Affan"
            message= _ "After you guys mysteriously disappeared, I took command of the remaining army. One of the soldiers accidentally stumbled across a trapdoor beneath the keep. That accident save our skins. We held out as long as we could against the endless hordes whilst the civilians were rushed inside. The veteran soldiers volunteered to stay above and buy us some time. I was the last to enter and as I descended, the door to the surface was sealed shut. We waited in the dimly-lit chambers for over a fortnight, battling hunger and waiting for the chance to retake the city."
        [/message]
        [message]
            speaker="Jahin"
            message= _ "Quick thinking. Were you able to save the entirety of the populace?"
        [/message]
        [message]
            speaker="Fairuz"
            message= _ "So, the trolls lived <i>beneath</i> the city the whole time? I used to wonder where they spent their days."
        [/message]
        [message]
            speaker="Affan"
            message= _ "Sadly, no. We saved the majority of the populace and a few dozen soldiers. The rest were either slaughtered or died of hunger."
        [/message]

        [message]
            speaker="Jahin"
            message= _ "Did the Imperialists just ransack the city? Did they take anything or anyone?"
        [/message]
        [message]
            speaker="Affan"
            message= _ "Sorry. I don't know, mate."
        [/message]

        [message]
            speaker="Fairuz"
            message= _ "This is bad. This means that those goons will be back. What are we going to now?"
        [/message]
        [message]
            speaker="Jahin"
            message= _ "Fortify the remaining defenses, and hope that Kraag returns with reinforcements soon."
        [/message]

        [message]
            speaker="narrator"
            image="wesnoth-icon.png"
            message= _ "As Jahin spoke these words, an old friend returned..."
        [/message]

        {SCROLL_TO 1 1}
        {DELAY 1000}

        [unit]
            side=1
            facing=se
            {IS_HERO}
            unrenameable=yes
            animate=yes
            id="Kraag"
            name= _ "Kraag"
            type="Sky Drake"
            x,y=1,1
            [modifications]
                 {TRAIT_LOYAL}
                 {TRAIT_RESILIENT}
            [/modifications]
        [/unit]

        {MOVE_UNIT (id="Kraag") 7 7}

        {MODIFY_UNIT (id="Jahin") facing ne}
        {MODIFY_UNIT (id="Affan") facing ne}
        {MODIFY_UNIT (id="Fairuz") facing ne}

        {GENERIC_UNIT 1 "Orcish Warlord" 1 1}
        {GENERIC_UNIT 1 "Orcish Warrior" 1 1}
        {GENERIC_UNIT 1 "Orcish Crossbowman" 1 1}
        {GENERIC_UNIT 1 "Orcish Nightblade" 1 1}

        {GENERIC_UNIT 1 "Orcish Slayer" 1 4}
        {GENERIC_UNIT 1 "Orcish Crossbowman" 1 4}
        {GENERIC_UNIT 1 "Orcish Warrior" 1 4}
        {GENERIC_UNIT 1 "Orcish Warrior" 1 4}
        {GENERIC_UNIT 1 "Orcish Warrior" 1 4}
        {GENERIC_UNIT 1 "Orcish Slurbow" 1 4}
        {GENERIC_UNIT 1 "Orcish Slurbow" 4 4}
        {GENERIC_UNIT 1 "Orcish Ruler" 4 4}
        {GENERIC_UNIT 1 "Orcish Warrior" 4 4}
        {GENERIC_UNIT 1 "Orcish Warrior" 4 4}
        {GENERIC_UNIT 1 "Orcish Warrior" 4 4}
        {GENERIC_UNIT 1 "Orcish Warrior" 4 4}
        {GENERIC_UNIT 1 "Orcish Warrior" 4 4}
    
        [message]
            speaker="Kraag"
            message= _ "Jahin, I have returned with an army of orcs. But, what has happened here?"
        [/message]
        [message]
            speaker="Jahin"
            message= _ "Let's just say that we survived a massive attack. So, how is Kojac faring in the north?"
        [/message]
        [message]
            speaker="Kraag"
            message= _ "His forces have been very progressing these pass few months. They have weakened the legions to an extent where they are forced to switch to the defensive and shield themselves within their northernmost city. He has also sent a message for you. He requests you to join him and Lord Gashinar in the assault on the northern legion city. So, should I tell him that you are preoccupied here?"
        [/message]
        [message]
            speaker="Jahin"
            message= _ "No, I might join him in the north, but I shall be going alone. New Genesis needs all the soldiers it can get. So, I'm leaving my army here."
        [/message]
        [message]
            speaker="Fairuz"
            message= _ "Hang on, Jahin! I am not letting you go by yourself! If you go alone, what glory will be there for me?! I'm coming too!"
        [/message]
        [message]
            speaker="Jahin"
            message= _ "But, Fairuz, you are needed here. I can manage on my own."
        [/message]
        [message]
            speaker="Fairuz"
            message= _ "No, you need someone to watch your back in combat. Affan and Ashhab can manage things here."
        [/message]
        [message]
            speaker="Jahin"
            message= _ "I suppose you're right. Kraag, take rest for a few hours and then return North. Tell Kojac that Fairuz and I shall be joining him after a month or two."
        [/message]
        [message]
            speaker="Fairuz"
            message= _ "As for the rest of you, let's put out the fires and organize the defences as best as we can."
        [/message]

        [if]
            [have_unit]
                 side=1
                 race=fairy
            [/have_unit]
            [then]
                [message]
                    speaker="Jahin"
                    message= _ "Lady Amulia may need her faeries to repel the Imperialists. I shall send them back to their home."
                [/message]
            [/then]
            [else]
                [message]
                    speaker="Jahin"
                    message= _ "I shall send the remaining faeries back to their home in the southern forest. Lady Amulia may need them to fight the Imperialists."
                [/message]
            [/else]
        [/if]

        [kill]
            race=fairy
            animate=no
        [/kill]

        [store_unit]
            [filter]
                side=1
                race=dwarf
            [/filter]
            kill=yes
            variable=stored.dwarves
        [/store_unit]
        [store_unit]
            [filter]
                id="Ashhab"
            [/filter]
            kill=yes
            variable=stored.ashhab
        [/store_unit]
        [store_unit]
            [filter]
                id="Affan"
            [/filter]
            kill=yes
            variable=stored.affan
        [/store_unit]

        [kill]
           animate=no
           race=orc
        [/kill]

        [store_unit]
            [filter]
                side=1
                [not]
                   id="Jahin"
                [/not]
                [not]
                   id="Fairuz"
                [/not]
                [not]
                   id="Kraag"
                [/not]
            [/filter]
            kill=yes
            variable=stored.recalls
        [/store_unit]

        [disallow_recruit]
            side=1
            type="Infantryman,Bowman,Cavalryman,Cavalry Archer,Faerie Sprite,Dwarvish Fighter,Dwarvish Thunderer,Heavy Infantryman"
        [/disallow_recruit]

        [endlevel]
            result="victory"
            bonus=yes
            {NEW_GOLD_CARRYOVER 80}
        [/endlevel]
    [/event]

    [event]
        name="last breath"
        first_time_only=yes
        [filter_second]
            id="Jahin"
        [/filter_second]
        [message]
            speaker="Jahin"
            message= _ "That was for Affan!"
        [/message]
    [/event]

    [event]
        name="last breath"
        first_time_only=yes
        [filter_second]
            id="Fairuz"
        [/filter_second]
        [message]
            speaker="Fairuz"
            message= _ "This is for all the lives you have taken!"
        [/message]
    [/event]

    [event]
        name="turn 6"
        first_time_only=yes

        # A surprise since the Chaos goons are too tough.

        {THUNDER (
            [harm_unit]
                 [filter]
                     side=2
                 [/filter]
                 type=fire
                 animate=yes
                 fire_event=yes
                 alignment=neutral
                 amount=10
            [/harm_unit]
        )}

        [message]
             speaker="Jahin"
             message= _ "What on Irdya was that?!"
        [/message]
        [message]
             speaker="Ashhab"
             message= _ "Sorry, I was trying to cast a spell from this book."
        [/message]
        [message]
             speaker="Fairuz"
             message= _ "Don't apologize for that, you twit! Do it again, the enemy is weakening!"
        [/message]
        [message]
             speaker="Ashhab"
             message= _ "Alright. Here goes nothing!"
        [/message]

        {THUNDER (
            [harm_unit]
                 [filter]
                     side=2
                 [/filter]
                 type=fire
                 animate=yes
                 fire_event=yes
                 alignment=neutral
                 amount=10
            [/harm_unit]
        )}
    [/event]

[/scenario]