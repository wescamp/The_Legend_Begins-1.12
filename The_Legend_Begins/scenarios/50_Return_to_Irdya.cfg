#textdomain wesnoth-The_Legend_Begins

[scenario]
    id="50_Return_to_Irdya"
    name= _ "Return to Irdya"
    next_scenario="50x_Intermission"
    map_data="{~add-ons/The_Legend_Begins/maps/50_Return_to_Irdya.map}"

   {CLOUD_FIRST_WATCH}
   {CLOUD_SECOND_WATCH}
   {CLOUD_DAWN}
   {CLOUD_MORNING}
   {CLOUD_AFTERNOON}
   {CLOUD_DUSK}

   {DEFAULT_MUSIC_PLAYLIST}

   [story]
      [part]
          music="underground.ogg"
          story= _ "It was deja-vu all over again. One moment our heroes were inside the castle of Azura, and the next moment, they found themselves surrounded by darkness. The darkness slowly faded away, leaving Jahin and the others found themselves in the midst of a thick forest..."
      [/part]
   [/story]

   victory_when_enemies_defeated=no
   {TURNS 40 35 32}
   {TIME_OVER_DEFEAT}

   {~add-ons/The_Legend_Begins/macros/deaths.cfg}
   {~add-ons/The_Legend_Begins/macros/recurring-events.cfg}
   {~add-ons/The_Legend_Begins/macros/custom-advancement.cfg}

   # There is no need for a recruit/recall limit here
   # I will recall the entirety of your recall list here...


   # First try results
   # 1. Side 8 behaves abnormally. It pauses for a minute when all movements related to attacks have been used up.
   # 2. Side 4 decides to ignore side 1 and focus when destroying side 2 and 3.
   # 3. Side 5 is worthless. 

   # Flavor Text

   [event]
      name="turn 12"
      [message]
          speaker="Sadia"
          message= _ "Fairuz, if I die in battle today, I want you to know something."
      [/message]
      [message]
          speaker="Fairuz"
          message= _ "Nonsense! You're not gonna die. Jahin and I will be shielding you from every foe. Right, Jahin?"
      [/message]
      [message]
          speaker="Jahin"
          message= _ "Yeah. Sadia, you are our friend. We won't let anything happen to you."
      [/message]

      [message]
          speaker="Fairuz"
          message= _ "Now, what did you wanted to say?"
      [/message]
      [message]
          speaker="Sadia"
          message= _ "I have feelings for you."
      [/message]
      [message]
          speaker="Fairuz"
          message= _ "What?"
      [/message]
      [message]
          speaker="Jahin"
          message= _ "She means to say that she wants to be with you and start a family."
      [/message]
      [message]
          speaker="Sadia"
          message= _ "That is a bit too quick. I just want to be your lover, Fairuz."
      [/message]
      [message]
          speaker="Fairuz"
          message= _ "This is a lot to take in. Can we discuss this after the battle?"
      [/message]

      [message]
          speaker="Sadia"
          message= _ "<i>(sighs)</i> Fine by me."
      [/message]
   [/event]

   [event]
      name="turn 7"
      [gold]
         side=6
         amount=300
      [/gold]
      [gold]
         side=7
         amount=300
      [/gold]
      [gold]
         side=9
         amount=200
      [/gold]
      [gold]
         side=4
         amount=70
      [/gold]

      [gold]
         side=2
         amount=200
      [/gold]
      [gold]
         side=3
         amount=200
      [/gold]
      [gold]
         side=8
         amount=200
      [/gold]
   [/event]

   [event]
      name="turn 11"
      [gold]
         side=6
         amount=300
      [/gold]
      [gold]
         side=7
         amount=300
      [/gold]
      [gold]
         side=9
         amount=200
      [/gold]
      [gold]
         side=4
         amount=70
      [/gold]

      [gold]
         side=2
         amount=200
      [/gold]
      [gold]
         side=3
         amount=200
      [/gold]
      [gold]
         side=8
         amount=200
      [/gold]
   [/event]

   [event]
      name="turn 17"
      [gold]
         side=6
         amount=300
      [/gold]
      [gold]
         side=7
         amount=300
      [/gold]
      [gold]
         side=9
         amount=200
      [/gold]
      [gold]
         side=4
         amount=70
      [/gold]

      [gold]
         side=2
         amount=200
      [/gold]
      [gold]
         side=3
         amount=200
      [/gold]
      [gold]
         side=8
         amount=200
      [/gold]
   [/event]

   [event]
      name="turn 23"
      [gold]
         side=6
         amount=300
      [/gold]
      [gold]
         side=7
         amount=300
      [/gold]
      [gold]
         side=9
         amount=200
      [/gold]
      [gold]
         side=4
         amount=70
      [/gold]

      [gold]
         side=2
         amount=200
      [/gold]
      [gold]
         side=3
         amount=400
      [/gold]
      [gold]
         side=8
         amount=200
      [/gold]
   [/event]

   [event]
      name="turn 29"
      [gold]
         side=6
         amount=300
      [/gold]
      [gold]
         side=7
         amount=300
      [/gold]
      [gold]
         side=9
         amount=200
      [/gold]
      [gold]
         side=4
         amount=70
      [/gold]

      [gold]
         side=2
         amount=200
      [/gold]
      [gold]
         side=3
         amount=200
      [/gold]
      [gold]
         side=8
         amount=200
      [/gold]
   [/event]

   [event]
      name="turn 36"
      [gold]
         side=6
         amount=300
      [/gold]
      [gold]
         side=7
         amount=300
      [/gold]
      [gold]
         side=9
         amount=200
      [/gold]
      [gold]
         side=4
         amount=70
      [/gold]

      [gold]
         side=2
         amount=200
      [/gold]
      [gold]
         side=3
         amount=200
      [/gold]
      [gold]
         side=8
         amount=200
      [/gold]
   [/event]

   [side]
      side=1
      team_name="good"
      user_team_name= _ "New Genesis"
      {FLAG_VARIANT loyalist}
      id="Jahin"
      name= _ "Jahin"
      shroud=yes
      fog=yes
      type="Captain"
      controller=human
      canrecruit=yes
      gold=0
      income=-2
      recruit="Bladesman,Bowman,Cavalryman,Cavalry Archer,Heavy Infantryman"
   [/side]

   [side]
      side=2
      team_name="good"
      user_team_name= _ "Elves"
      {FLAG_VARIANT wood-elvish}
      no_leader=yes
      {GOLD 750 625 550}
      income=58
      recruit="Elvish Druid,Elvish Hero,Elvish Marksman,Elvish Rider,Fire Faerie,Elvish Champion,Elvish Avenger"
      [ai]
         agression=0.75
         caution=0.25
         # Ignore Vampire Queen
         [target]
            side=4
            value=0
         [/target]
         # This cuts down suicide attempts
         {ATTACK_DEPTH 5 8 13}
         [target]
            side=7
            value=1000
         [/target]
         [protect_unit]
            id="Amorith"
            value=40.0
            radius=10
         [/protect_unit]
         [avoid]
            x=14-20
            y=18-32
         [/avoid]
         recruitment_ignore_bad_movement=yes
         recruitment_ignore_bad_combat=yes
      [/ai]
   [/side]

   [side]
      side=3
      team_name="good"
      user_team_name= _ "Elves"
      {FLAG_VARIANT wood-elvish}
      id="Morfin"
      name= _ "Lord Morfin"
      type="Elvish High Lord"
      {GOLD 750 625 550}
      income=58
      recruit="Elvish Druid,Elvish Hero,Elvish Marksman,Elvish Rider,Fire Faerie,Elvish Avenger,Elvish Champion"

      [unit]
          side=3
          id="Amarang"
          name= _ "Lady Amarang"
          {IS_HERO}
          type="Elvish Sylph"
          ai_special=guardian
          x,y=2,3
          [modifications]
               {TRAIT_LOYAL}
          [/modifications]
      [/unit]

      [ai]
         agression=0.75
         caution=0.25
         # Ignore Vampire Queen
         [target]
            side=4
            value=0
         [/target]
         {ATTACK_DEPTH 5 8 13}
         [target]
            side=7
            value=1000
         [/target]
         [avoid]
            x=14-20
            y=18-32
         [/avoid]
         recruitment_ignore_bad_movement=yes
         recruitment_ignore_bad_combat=yes
         [protect_unit]
            id="Amarang"
            value=40.0
            radius=10
         [/protect_unit]
      [/ai]
   [/side]

   [side]
      side=4
      team_name="bad"
      user_team_name= _ "Vampires"
      id="Anuvien"
      overlays="misc/boss-icon.png"
      {FLAG_VARIANT long}
      name= _ "Queen Anuvien"
      type="Vampire Queen"
      {GOLD 1000 1200 1600}
      village_gold=0
      income=48
      recruit="Twilight Walker,Terror Hulk,Sire,Sword Dancer,Sangel,Mistress,Marlgoyle,Day Hunter"
      [ai]
         grouping=offensive
         agression=200.0
         recruitment_ignore_bad_movement=yes
         recruitment_ignore_bad_combat=yes
         [target]
             id="Morfin"
             value=100
         [/target]
         [target]
             id="Jahin"
             value=50
         [/target]
         [target]
             id="Sadia"
             value=50
         [/target]
      [/ai]
   [/side]

   {STARTING_VILLAGES_ALL 4}

   {FORCE_CHANCE_TO_HIT (
      [not]
         id="Sadia"
      [/not]
    ) (id="Anuvien") 0 ()}

   {FORCE_CHANCE_TO_HIT (id="Sadia") (id="Anuvien") 100 ()}

   [event]
      name="last breath"
      [filter]
         id="Anuvien"
      [/filter]
      [filter_second]
         id="Sadia"
      [/filter_second]
      [message]
         speaker="Sadia"
         message= _ "<i>(enraged)</i> This is for killing my father!"
      [/message]      

      [message]
          speaker="Solita"
          message= _ "She didn't kill your father! I did!"
      [/message]

      [message]
          speaker="Sadia"
          message= _ "What?!"
      [/message]

      [message]
          speaker="Fairuz"
          message= _ "Sadia! Watch out!"
      [/message]

      [animate_unit]
          flag=attack

          [filter]
              id="Anuvien"
          [/filter]
          
          [primary_attack]
              name=blood kiss
          [/primary_attack]

          hits=yes
          text="<i>Bite!</i>"
          red=255
          green=0
          blue=0

          [facing]
             [filter]
                id="Sadia"
             [/filter]
          [/facing]
      [/animate_unit]

      [kill] 
          id="Sadia"
          animate=yes
          fire_event=no
      [/kill]

      
      [message]
          speaker="narrator"
          image="wesnoth-icon.png"
          message= _ "Sadia fails to defend herself from a sudden lunge made by the vampire queen. The queen grabs Sadia by the neck and bites her with so much force that her neck snaps. Sadia falls to the ground, motionless. But, the queen, having done the deed, suddenly becomes engulfed in flames, reduced to ashes in mere moments..."
      [/message]

      [object]
            silent=yes
            [filter]
                id="Anuvien"
            [/filter]
            [effect]
                apply_to=new_animation
                [extra_anim]
                    flag=cutscene_burning
                    start_time=-400

                    {FLAME_BLAST_ANIMATION}

                    # Override stock animation offsets
                    offset=0.0~-0.1
                    {FLAME_BLAST_AFFECTS_SELF}

                    [frame]
                        #sound=fire.wav
                        duration=100
                    [/frame]
                    [frame]
                        sound={SOUND_LIST:LICH_HIT}
                        duration=100
                    [/frame]
                    [frame]
                        duration=200
                    [/frame]
                    [frame]
                        sound={SOUND_LIST:LICH_HIT}
                        duration=100
                    [/frame]
                    [frame]
                        sound=fire.wav
                        duration=100
                    [/frame]
                [/extra_anim]
            [/effect]
        [/object]

        {FLASH_RED (
            [animate_unit]
                [filter]
                    id="Anuvien"
                [/filter]
                flag=cutscene_burning
                with_bars=yes
            [/animate_unit]
        )}

       {DELAY 200}

       [kill]
          id="Anuvien"
          kill=yes
          fire_event=no
       [/kill]

       [message]
           speaker="Jahin"
           message= _ "Curse that slut! The vampires took another friend from me! But, at least, Sadia reduced her to ashes."
       [/message]

       [fire_event]
           name="tragic_victory"
       [/fire_event]
   [/event]

   [event]
      name="tragic_victory"

      [message]
          race=vampire
          message= _ "Oh, no! The queen has fallen! Retreat!"
      [/message]

      [kill]
          side=5
          animate=no
      [/kill]
      [kill]
          side=6
          animate=no
      [/kill]
      [kill]
          side=7
          animate=no
      [/kill]
      [kill]
          side=9
          animate=no
      [/kill]
      
      {DELAY 200}

      [message]
          speaker="Fairuz"
          message= _ "Sadia..."
      [/message]
      [message]
          speaker="Ashhab"
          message= _ "<i>(depressed)</i> How many more friends will the vampires take from us, Jahin? I say we strike their capital next!"
      [/message]
      [message]
          speaker="Jahin"
          message= _ "<i>(depressed)</i> As much as I would love to see every one of these rotten blood-suckers dead, we can't. Ashhab, our men are exhausted. We have lost so many already and, New Genesis is defenseless right now."
      [/message]

      [message]
          speaker="Ashhab"
          message= _ "Fairuz, we should arranged a funeral for her."
      [/message]
      [message]
          speaker="Jahin"
          message= _ "Lord Morfin, will it be alright if we dug Sadia's grave on this courtyard?"
      [/message]
      [message]
          speaker="Morfin"
          message= _ "Jahin, you and your people have helped us many times. And for that, I grant you permission and I will arrange the funeral myself."
      [/message]

      [endlevel]
          result=victory
          {NEW_GOLD_CARRYOVER 0}
          bonus=no
      [/endlevel]
   [/event]

   [side]
      side=5
      team_name="bad"
      user_team_name= _ "Vampires"
      id="Wynn"
      {FLAG_VARIANT long}
      name= _ "Lord Wynn"
      type="Sire"
      canrecruit=yes
      {GOLD 500 650 800}
      income=28
      recruit="Vampire Duelist,Half Blood,Blood Manipulator,Blood Hulk"
      [ai]
         grouping=offensive
         agression=1.0
         recruitment_ignore_bad_movement=yes
         recruitment_ignore_bad_combat=yes
         {ATTACK_DEPTH 5 8 13}
         [target]
             id="Morfin"
             value=100
         [/target]
         [target]
             id="Jahin"
             value=50
         [/target]
      [/ai]  
   [/side]

   [event]
       name="die"
       [filter]
           id="Wynn"
       [/filter]
       [message]
           speaker="Jahin"
           message= _ "Die, blood-sucking scum!"
       [/message]
       [message]
           speaker="Fairuz"
           message= _ "Nicely said, mate!"
       [/message]
   [/event]

   [side]
      side=6
      team_name="bad"
      user_team_name= _ "Vampires"
      id="Solita"
      {FLAG_VARIANT long}
      name= _ "Princess Solita"
      type="Duchess"
      canrecruit=yes
      {GOLD 500 650 800}
      income=48
      recruit="Vampire Duelist,Half Blood,Blood Manipulator,Blood Hulk"
      [ai]
         grouping=offensive
         agression=1.0
         recruitment_ignore_bad_movement=yes
         recruitment_ignore_bad_combat=yes
         [target]
             id="Morfin"
             value=100
         [/target]
         [target]
             id="Jahin"
             value=50
         [/target]
      [/ai]  
   [/side]

   {FORCE_CHANCE_TO_HIT (side=1) (id="Solita") 30 ()}
   {FORCE_CHANCE_TO_HIT (side=2) (id="Solita") 30 ()}
   {FORCE_CHANCE_TO_HIT (side=3) (id="Solita") 30 ()}
   {FORCE_CHANCE_TO_HIT (side=8) (id="Solita") 30 ()}

   [event]
       name="attacker hits"
       [filter_second]
            id="Solita"
       [/filter_second]
       [message]
          speaker="unit"
          message= _ "Things aren't looking too good here. I'm off to the capital!"
       [/message]

       [kill]
          id="Solita"
          animate=no
       [/kill]
       [message]
           speaker="Anuvien"
           message= _ "Insolsent girl! Minions, keep fighting!"
       [/message]

       [message]
           speaker="Sadia"
           message= _ "You're next, slut!"
       [/message]
   [/event]

   [side]
      side=7
      team_name="bad"
      user_team_name= _ "Vampires"
      id="Vincent"
      {FLAG_VARIANT long}
      name= _ "Lord Vincent"
      type="Methusalem"
      canrecruit=yes
      {GOLD 500 650 800}
      income=48
      recruit="Vampire Duelist,Half Blood,Blood Manipulator,Blood Hulk"
      [ai]
         grouping=offensive
         agression=1.0
         recruitment_ignore_bad_movement=yes
         recruitment_ignore_bad_combat=yes
         [target]
             id="Morfin"
             value=100
         [/target]
         [target]
             id="Jahin"
             value=50
         [/target]
      [/ai]  
   [/side]

   [event]
       name="die"
       [filter]
           id="Vincent"
       [/filter]
       [message]
           speaker="Ashhab"
           message= _ "Rot in hell, vampire!"
       [/message]
   [/event]

   [side]
      side=8
      team_name="good"
      user_team_name= _ "Southern Elves"
      {FLAG_VARIANT ragged}
      {IS_EXPENDABLE_LEADER}
      id="Comdr. Kr'tan"
      name= _ "Comdr. Kr'tan"
      type="South Elven Champion"
      {GOLD 750 625 550}
      income=48
      recruit="South Elven Guard,South Elven Hunter,South Elven Warrior,South Elven Protector,South Elven Mystic,Sun Priestess,Moon Cleric,South Elven Marksman,Gallant Carapace,South Elven Champion"
      [ai]
         agression=0.50
         caution=0.50
         passive_leader=yes
         {ATTACK_DEPTH 5 8 13}
         # Ignore Vampire Queen
         [target]
            side=4
            value=0
         [/target]
         [protect_unit]
             [filter]
                 id="Morfin"
             [/filter]
             value=40.0
             radius=10
         [/protect_unit]
         [target]
            side=7
            value=1000
         [/target]
         [avoid]
            x=14-20
            y=18-32
         [/avoid]
         recruitment_ignore_bad_movement=yes
         recruitment_ignore_bad_combat=yes
      [/ai]
   [/side]

   [event]
       name="die"
       [filter]
           id="Comdr Kr'tan"
       [/filter]
       [message]
           speaker="Morfin"
           message= _ "Rest in peace, Kr'tan, son of Norfildor."
       [/message]
   [/event]

   [side]
      side=9
      team_name="bad"
      user_team_name= _ "Vampires"
      id="Vinvan"
      {FLAG_VARIANT long}
      name= _ "Lord Vinvan"
      type="Faun Lord"
      canrecruit=yes
      {GOLD 500 650 800}
      income=38
      recruit="Sentinel Golem,Faun Captain,Faun Marksman,Rodent Rider,Sasquatch,Rodent Predator"
      [ai]
         grouping=offensive
         agression=1.0
         recruitment_ignore_bad_movement=yes
         recruitment_ignore_bad_combat=yes
         [target]
             id="Morfin"
             value=100
         [/target]
         [target]
             id="Jahin"
             value=50
         [/target]
      [/ai]  
   [/side]

   [event]
       name="die"
       [filter]
           id="Vinvan"
       [/filter]
       [message]
           speaker="Fairuz"
           message= _ "Die, horse-butt!"
       [/message]
       [message]
           speaker="Jahin"
           message= _ "<i>(laughing)</i> That was just cold, man! He had the behind of a goat!"
       [/message]
   [/event]

   [event]
       name="moveto"
       first_time_only=yes
       [filter]
           side=1
           race=human
           [filter_location]
                terrain="Wwb"
           [/filter_location]
       [/filter]

       [message]
           speaker="unit"
           message= _ "What is this?! It's feels like water, but thicker."
       [/message]
       [message]
           race="vampire"
           message= _ "Get out of there, nincompoop! That's our blood storage!"
       [/message]
       [message]
           speaker="unit"
           message= _ "Blood?! I cannot comprehend how many humans these monsters must have bled dry!"
       [/message]
   [/event]

   [event] 
      name="last breath"
      [filter]
         id="Morfin"
      [/filter]
      [message]
         speaker="unit"
         message= _ "Argh! I'm done!"
      [/message]
      [message]
         speaker="Jahin"
         message= _ "The elven lord was supposed to be kept alive!"
      [/message]
   [/event]
 
   [event]
      name="die"
      [filter]
         id="Morfin"
      [/filter]
      [endlevel]
         result=defeat
      [/endlevel]
   [/event]

   [event] 
       name="last breath"
       [filter]
         id="Amarang"
       [/filter]
       [message]
         speaker="Jahin"
         message= _ "The elven lady was supposed to be kept alive!"
       [/message]
   [/event]
 
   [event]
      name="die"
      [filter]
         id="Amarang"
      [/filter]
      [endlevel]
         result=defeat
      [/endlevel]
   [/event]

   [event]
      name="prestart"

      {CLEAR_VARIABLE damage_inflicted,heal_amount,lava_count,path_taken,surprise,units_to_slay,x1,x2,y1,y2}

      [recall]
          id="Sadia"
      [/recall]
      [recall]
          id="Fairuz"
      [/recall] 
      [recall]
          id="Healer"
      [/recall]

      [store_unit]
         [filter]
            side=1
         [/filter]
         kill=yes
         x,y=recall,recall
         variable="recalls"
      [/store_unit]

      {FOREACH recalls i}
         [unstore_unit]
             variable=recalls[$i]
         [/unstore_unit]
         [recall]
             id=$recalls[$i].id
         [/recall]
      {NEXT i}

      {CLEAR_VARIABLE recalls}

      [modify_side]
         side=1
         income=-2
         village_gold=0
         gold=0
      [/modify_side]

      [unstore_unit]
          variable="stored.galec"
          x,y=4,9
      [/unstore_unit]

      [modify_unit]
          [filter]
              id="Galec"
          [/filter]
           side=2
           canrecruit=yes
           {UNMAKE_HERO (id="Galec")}
      [/modify_unit]

      [unstore_unit]
          variable="stored.amorith"
          x,y=2,4
      [/unstore_unit]

      [modify_unit]
          [filter]
              id="Amorith"
          [/filter]
           side=2
           ai_special=guardian
      [/modify_unit]

      {FOREACH stored.elves i}
          [unstore_unit]
              variable=stored.elves[$i]
              x,y=4,9
              find_vacant=yes
          [/unstore_unit]
          [modify_unit]
              [filter]
                  id=$stored.elves[$i].id
              [/filter]
              side=2
          [/modify_unit]
      {NEXT i}

      {CLEAR_VARIABLE stored.elves}

      {FOREACH stored.faeries i}
          [unstore_unit]
              variable=stored.faeries[$i]
              x,y=5,12
              find_vacant=yes
          [/unstore_unit]
          [modify_unit]
              [filter]
                  id=$stored.faeries[$i].id
              [/filter]
              side=2
          [/modify_unit]
      {NEXT i}

      {CLEAR_VARIABLE stored.faeries}

      [unstore_unit]
          variable="stored.ashhab"
          x,y=4,8
          find_vacant=yes
      [/unstore_unit]

      [modify_unit]
          [filter]
              id="Ashhab"
          [/filter]
          ai_special=guardian
          side=2
      [/modify_unit]

      {CLEAR_VARIABLE stored.galec,stored.amorith,stored.ashhab}

      {GENERIC_UNIT 4 "Twilight Walker" 18 23}{GUARDIAN}
      {GENERIC_UNIT 4 "Sire" 20 27}{GUARDIAN}
      {GENERIC_UNIT 4 "Sword Dancer" 22 28}{GUARDIAN}
      {GENERIC_UNIT 4 "Sire" 26 28}{GUARDIAN}
      {GENERIC_UNIT 4 "Twilight Walker" 25 28}{GUARDIAN}
      {GENERIC_UNIT 4 "Day Hunter" 27 27}{GUARDIAN}
      {GENERIC_UNIT 4 "Terror Hulk" 26 26}{GUARDIAN}
      {GENERIC_UNIT 4 "Sire" 24 23}{GUARDIAN}
      {GENERIC_UNIT 4 "Twilight Walker" 25 24}{GUARDIAN}
      {GENERIC_UNIT 4 "Sangel" 29 25}{GUARDIAN}
      {GENERIC_UNIT 4 "Mistress" 27 23}{GUARDIAN}
      {GENERIC_UNIT 4 "Mistress" 22 21}{GUARDIAN}

      [store_unit]
          [filter]
             side=1
             race=fairy
          [/filter]
          kill=yes
          variable=faeries
      [/store_unit]

      {FOREACH faeries i}
         {VARIABLE $faeries[$i].side 2}

         [unstore_unit]
             variable=faeries[$i]
         [/unstore_unit]
         [recall]
             id=$faeries[$i].id
         [/recall]
      {NEXT i}

      {CLEAR_VARIABLE faeries}

      [store_unit]
          [filter]
             side=1
             race=elf
          [/filter]
          kill=yes
          variable=elves
      [/store_unit]

      {FOREACH elves i}
         {VARIABLE $elves[$i].side 2}

         [unstore_unit]
             variable=elves[$i]
         [/unstore_unit]
         [recall]
             id=$elves[$i].id
         [/recall]
      {NEXT i}

      {CLEAR_VARIABLE elves}
   [/event]

   #[item]
   #   x,y=39,53
   #   image="scenery/portal-open.png~SCALE(72,72)"
   #[/item]

   [event]
      name="start"
      [message]
          speaker="Jahin"
          message= _ "Where are we?"
      [/message]
      [message]
          speaker="Sadia"
          message= _ "I do not know, but look what we have here. This must be the portal that Azura spoke about. So, we might be in vampire lands."
      [/message]
      [message]
          speaker="Fairuz"
          message= _ "Hurry, let's destroy this portal."
      [/message]

      [sound]
          name="mace.wav"
      [/sound]
      [sound]
          name="fire.wav"
      [/sound]

      [terrain]
          x,y=39,53
          terrain=Gg^Pzd
      [/terrain]

      #[item]
      #    x,y=39,53
      #    image="scenery/portal-destroyed.png~SCALE(72,72)"
      #[/item]

      {DELAY 1000}

      [message]
          speaker="Jahin"
          message= _ "Okay, we have destroyed this one. Now, let's try to find a way home."
      [/message]

      [objectives]
          side=1
          [objective]
              description= _ "Explore."
              condition="win"
          [/objective]
          [objective]
              description= _ "Eliminate any enemies you find."
              condition="win"
          [/objective]
          
          [objective]
              description= _ "Death of Jahin."
              condition="lose"
          [/objective]
          [objective]
              description= _ "Death of a non-expendable allied leader."
              condition="lose"
          [/objective]
          [objective]
              description= _ "Death of any hero unit."
              condition="lose"
          [/objective]
          {TURNS_RUN_OUT}

          [gold_carryover]
              carryover_percentage=0
              bonus=no
          [/gold_carryover]
      [/objectives]
   [/event]

   [event]
       name="turn 3"

       [message]
           speaker="narrator"
           image="wesnoth-icon.png"
           message= _ "The fog disappears..."
       [/message]
       
       [modify_side]
           side=1
           shroud=no
           fog=no
       [/modify_side]

       [message]
           speaker="Sadia"
           message= _ "Look to the north!"
       [/message]

       {SCROLL_TO 4 8}
       {DELAY 500}

       [message]
           speaker="Galec"
           message= _ "Look! Vampires have received reinforcements from yonder portal!"
       [/message]
       [message]
           speaker="Amorith"
           message= _ "They do not look like reinforcements..."
       [/message]
       
       [message]
           speaker="Sadia"
           message= _ "Galec?!"
       [/message]
       [message]
           speaker="Jahin"
           message= _ "Amorith?!"
       [/message]
       # I don't want Ashhab to feel left out

       [message]
           speaker="Ashhab"
           message= _ "Jahin and Sadia?!"
       [/message]

       [message]
          speaker="Fairuz"
          message= _ "Ashhab?!"
       [/message]

       [message]
           speaker="Galec"
           message= _ "Sadia, Jahin and Fariuz?! How did you manage to get here?!"
       [/message]
       [message]
           speaker="Jahin"
           message= _ "It's a quite a long story. But, can you help my men get out of here. We are greatly fatigued."
       [/message]

       [message]
           speaker="Galec"
           message= _ "I wish we could, but as you can see, we are sorely pressed. The vampire's southern flank is here..."
       [/message]
       [message]
           speaker="Ashhab"
           message= _ "The vampire army north of here is trying to reach the queen. So, she is our main target."
       [/message]

       [message]
           speaker="Fairuz"
           message= _ "So, we just kill the queen and the vampires leave?"
       [/message]
       [message]
           speaker="Ashhab"
           message= _ "Affirmative. Leave the vampire army to the elves and focus on the queen."
       [/message]
       [message]
           speaker="Sadia"
           message= _ "Jahin, don't tell me that you are gonna order an attack! Your soldiers are too tired for another fight!"
       [/message]

       # This rashness of Jahin is gonna have consequences later. Mutiny.

       [message]
           speaker="Jahin"
           message= _ "Too late. Soldiers of New Genesis, to arms!"
       [/message]
       [message]
           speaker="Sadia"
           message= _ "Fairuz, stop him! The queen is too powerful!"
       [/message]
       [message]
           speaker="Fairuz"
           message= _ "Jahin, save some for me!"
       [/message]

       [message]
           speaker="Sadia"
           message= _ "<i>(sighs)</i> Men, I will never understand them..."
       [/message]

       [modify_unit]
           [filter]
               id="Ashhab"
           [/filter]
           side=1
       [/modify_unit]

       [objectives]
          side=1
          note= _ "This is last battle scenario (for this episode)."
          [objective]
              description= _ "Defeat the Vampire Queen."
              condition="win"
          [/objective]
          
          [objective]
              description= _ "Death of Jahin."
              condition="lose"
          [/objective]
          [objective]
              description= _ "Death of a non-expendable allied leader."
              condition="lose"
          [/objective]
          [objective]
              description= _ "Death of any hero unit."
              condition="lose"
          [/objective]
          
          {TURNS_RUN_OUT}

          [gold_carryover]
              carryover_percentage=0
              bonus=no
          [/gold_carryover]
       [/objectives]
   [/event]

   [event]
       name="turn 7"
       [fire_event]
            name="queen_talks"
       [/fire_event]
   [/event]

   [event]
       name="queen_talks"

       [message]
          speaker="Anuvien"
          message= _ "It is truly a shame to see so many elves die."
       [/message]
       [message]
          speaker="Sadia"
          message= _ "Why do you care for the elves, you heartless slut?!"
       [/message]
       [message]
          speaker="Anuvien"
          message= _ "Silence whore! I was once an elf before I accepted immortality!"
       [/message]
       [message]
          speaker="Morfin"
          message= _ "You can't be a former elf. The only elf who was known to dwell here was Anuvien - Sorceress Supreme. And, that was hundreds of years ago..."
       [/message]
       [message]
          speaker="Anuvien"
          message= _ "It feels good to know that my kind hasn't forgotten me. I was trying to find the Sacred Pendant, but I was met by someone with whom I fell in love instantly. He offered me immortality and I accepted. So, here I am today."
       [/message]
       [message]
          speaker="Galec"
          message= _ "You are a monster and not an elf! You deserve to die!"
       [/message]
       [message]
          speaker="Fairuz"
          message= _ "<i>(whispers)</i> The vampire queen was an elf?!"
       [/message]
       [message]
          speaker="Sadia"
          message= _ "<i>(whispers)</i> Wasn't it obvious? She has blonde hair."
       [/message]
       [message]
          speaker="Amarang"
          message= _ "Brother, let's cleanse this place from it's dark residents!"
       [/message]
       [message]
          speaker="Anuvien"
          message= _ "Most of your warriors will fall prey to me. I cannot be killed by man or elf."
       [/message]
       [message]
          speaker="Sadia"
          message= _ "<i>(whispers)</i> Jahin and Fairuz, get me close to her. I will kill that promiscuous nuisance!"
       [/message]
       [message]
           speaker="Fairuz"
           message= _ "<i>(whispers)</i> Okay, but why do you refer to her as promiscuous, you have just seen her."
       [/message]
       [message]
           speaker="Sadia"
           message= _ "<i>(whispers)</i> Just get me close to her! I will tell you two later."
       [/message]

       [objectives]
          side=1
          silent=no
          note= _ "This is last battle scenario (for this episode)."
          [note]
              description= _ "The Vampire Queen's immense beauty can be a trap to male-oriented units. So, it is wise to keep Jahin, Ashhab and Fairuz away from her."
          [/note]
          [note]
              description= _ "Only Sadia can damage Queen Anuvien..."
          [/note]
          [objective]
              description= _ "Defeat the Vampire Queen with Sadia."
              condition="win"
          [/objective]
          
          [objective]
              description= _ "Death of Jahin."
              condition="lose"
          [/objective]
          [objective]
              description= _ "Death of a non-expendable allied leader."
              condition="lose"
          [/objective]
          [objective]
              description= _ "Death of any hero unit."
              condition="lose"
          [/objective]
          {TURNS_RUN_OUT}

          [gold_carryover]
              carryover_percentage=0
              bonus=no
          [/gold_carryover]
       [/objectives]
   [/event]

# This is story plot purposes.
# The narrator is Ashhab's great-grandson.
# So, he needs sources to tell Jahin tale.

   [event]
       name="turn 9"

       [message]
           speaker="Sadia"
           message= _ "Jahin, do you know how to read?"
       [/message]
       [message]
           speaker="Jahin"
           message= _ "Well, no. I've spent my youth training with the sword and working in the fields or mines. There was simply no time for that."
       [/message]
       [message]
           speaker="Sadia"
           message= _ "That's a shame. I had Faria's journal. She gave it to me for reading when we had reclaimed New Genesis. I've finished reading it now, and I thought that you did like to read it."
       [/message]
       [message]
            speaker="Jahin"
            message= _ "Well, can you give me the journal for safe-keeping? Perhaps someday I will be able to read it."
       [/message]
       [message]
            speaker="Sadia"
            message= _ "<i>(handing Jahin the journal)</i> Sure."
       [/message]
   [/event]

[/scenario]